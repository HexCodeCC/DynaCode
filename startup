-- Build and load DynaCode.
shell.run("dobuild.lua", "src", "bin/DynaCode.lua")
dofile("bin/DynaCode.lua")

log:setLoggingEnabled( true )
log:setLoggingPath("DynaCode.log")

myApp = Application( term.getSize() )
myWindow = myApp + Stage( 10, 7, 30, 10 )
myWindow.title = "TextInput Demo"

secondWindow = myApp + Stage {
    title = "Test Window";
    X = 4;
    Y = 4;
    width = 15;
    height = 10;
    backgroundColor = colours.blue
}

thirdWindow = myApp + Stage {
    title = "Another Window";
    X = 30;
    Y = 10;
    width = 15;
    height = 10
}

-- Lets create two pages
homePage = Template( "homePageTemplate", myWindow )
aboutPage = Template( "aboutPageTemplate", myWindow )

-- On the first, we will have a panel
myPanel = homePage + Panel( 2, 1, 28, 9 )
myPanel.backgroundColour = colours.yellow
myPanel.name = "mainPanel"

innerPanel = myPanel + Panel( 2, 2, 25, 7 )
innerPanel.backgroundColour = colours.blue
innerPanel.name = "innerPanel"

anotherButton = innerPanel + Button( "Test", 2, 2, 22, 10 )
function anotherButton:onTrigger()
    self.text = "Check the logfile ("..log:getLoggingPath()..")!"
    log("Button Clicked", "Stop clicking me!")
end

-- that contains a button
myButton = myPanel + Button("Close App", 11, 10, 7, 4)
myButton.backgroundColour = colours.red
myButton.activeBackgroundColour = colours.orange
function myButton:onTrigger()
    myApp:finish()
end

-- under the panel we'll have a label
infoLabel = homePage + Label("'ctrl+b' to swap page", 5, 10)

-- On the second page we'll have a text container.
--[==[myText = aboutPage + TextContainer([[
@align-center Hello friend, this is a @tc-blue  TextContainer@tc-grey . Pretty cool huh?

This text will develop a scroll bar to allow for loooooads of text!

The text can also be aligned to the left, right or center of the TextContainer.

@tc-yellow Press 'ctrl+b' to return to the main page.

@align-center Hello friend, this is a @tc-blue  TextContainer@tc-grey . Pretty cool huh?

This text will develop a scroll bar to allow for loooooads of text!

The text can also be aligned to the left, right or center of the TextContainer.

@tc-yellow Press 'ctrl+b' to return to the main page.

@align-center Hello friend, this is a @tc-blue  TextContainer@tc-grey . Pretty cool huh?

This text will develop a scroll bar to allow for loooooads of text!

The text can also be aligned to the left, right or center of the TextContainer.

@tc-yellow Press 'ctrl+b' to return to the main page.
]], 1, 1, 30, 9)
]==]
-- Set the active template to our first page
myWindow.activeTemplate = aboutPage

inp = aboutPage + TextInput( 1, 1, 30, 9 )
inp.defaultAlignment = "left"
inp.cursorColor = colours.cyan
inp.textColour = colours.grey

inp.text="Hello\n\nWorld\n\nHow are you doing this fine evening?"

-- and make some hotkeys
myApp.hotkey:registerCombination("swapPage", "ctrl-b", function()
    myWindow.activeTemplate = myWindow.activeTemplate == homePage and aboutPage or homePage
end)

myApp.hotkey:registerCombination("close", "ctrl-x", function()
    myApp:finish()
end)

myApp:appendStagesFromDCML("stages.dcml")

local mainStage = myApp:getStageByName("MainStage")
mainStage:focus()

mainStage:addToController("hey", function( self )
    self.stage:close()
end)

-- finally run the application
myApp:run()
